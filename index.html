<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grades Calculator</title>
 <!-- Include PyScript -->
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    <style>
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: rgb(36, 37, 37);
        }

        h1 {
            color: #d6d6d6;
        }

        form {
            display: flex;
            flex-direction: column;
            width: 300px;
            padding: 20px;
            border: 1px solid #000000;
            border-radius: 5px;
            background-color: #686868;
        }

        label {
            margin-bottom: 5px;
        }

        input[type="number"] {
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }

        button[type="submit"] {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        h2 {
            color: #929292;
            margin-top: 20px;
        }

        p {
            color: #929292;
        }
    </style>
</head>
<body>
    <h1>Grades Calculator</h1>
    <form method="POST">
        <label for="prelim_grade">Preliminary Grade:</label>
        <input type="number" id="prelim_grade" name="prelim_grade" required placeholder="Enter Prelim Grade"> 
        <button type="submit">Calculate</button>
    </form>  
    {% if error_message %}
    <p style="color: red;">{{ error_message }}</p>
{% endif %}
{% if prelim_grade_result %}
    <h2>Result:</h2>
    <p>{{ prelim_grade_result }}</p>
    <p>{{ midterm_result }}</p>
    <p>{{ finals_result }}</p>
    {% if message %}
        <p>{{ message }}</p>
    {% endif %}
    {% if dean_lister_message %}
        <p>{{ dean_lister_message }}</p>
    {% endif %}
{% endif %}

<py-script>
    from pyscript import Element

def calculate_required_grades(prelim_grade):
    passing_grade = 75
    prelim_weight = 0.20
    midterm_weight = 0.30
    final_weight = 0.50
    grade_range = (0, 100)
    dean_lister_threshold = 90
    
#Computation of prelim grade to 20%
    current_total = prelim_grade * prelim_weight
#Calculation of grades required for midterm and finals
    required_total = passing_grade - current_total
    midterm_final_weight = midterm_weight + final_weight
#Calculation of average grades required for midterm and finals
    min_required_average = required_total / midterm_final_weight
#Calculation of required grades for Dean's Lister
    required_total_dean_lister = dean_lister_threshold - current_total
    min_required_average_dean_lister = required_total_dean_lister / midterm_final_weight

#To make sure the grades entered is only between 0 and 100
    if not (grade_range[0] <= prelim_grade <= grade_range[1]):
        return "Error: Preliminary grade must be between 0 and 100."

    if min_required_average < grade_range[0]:
        min_required_average = grade_range[0]
    
    if min_required_average_dean_lister < grade_range[0]:
        min_required_average_dean_lister = grade_range[0]

    if prelim_grade < 70:
        return ("Prelim Grade: {:.2f}".format(prelim_grade),
                "Required Grade for Midterm: {:.2f}".format(min_required_average), 
                "Required Grade for Finals: {:.2f}".format(min_required_average), 
                "It is Difficult to Pass!", True,
                "It's impossible for you to be a Dean's Lister." if min_required_average_dean_lister > 100 else 
                "The Required Grade for you to be a Dean’s Lister is {:.2f} (Midterm) and {:.2f} (Finals).".format(min_required_average_dean_lister, min_required_average_dean_lister))

    else:
        return ("Prelim Grade: {:.2f}".format(prelim_grade),
                "Required Grade for Midterm: {:.2f}".format(min_required_average), 
                "Required Grade for Finals: {:.2f}".format(min_required_average), 
                "You Have a Chance to Pass!", False,
                "It's impossible for you to be a Dean's Lister." if min_required_average_dean_lister > 100 else 
                "The Required Grade for you to be a Dean’s Lister is {:.2f} (Midterm) and {:.2f} (Finals).".format(min_required_average_dean_lister, min_required_average_dean_lister))

@app.route('/', methods=['GET', 'POST'])
def index():
    result = None
    message = None
    pass_chance = None
    dean_lister_message = None
    prelim_grade_result = None
    midterm_result = None
    finals_result = None
    error_message = None
    if request.method == 'POST':
        prelim_grade = request.form['prelim_grade']
        try:
            prelim_grade = float(prelim_grade)
            if not (0 <= prelim_grade <= 100):
                error_message = "Error: Preliminary grade must be between 0 and 100."
                result = ("Prelim Grade: {}".format(prelim_grade), error_message, None, None, None)
            else:
                result = calculate_required_grades(prelim_grade)
                if isinstance(result, tuple):
                    prelim_grade_result, midterm_result, finals_result, message, pass_chance, dean_lister_message = result
        except ValueError:
            error_message = "Error: Preliminary grade must be a number."
            result = ("Prelim Grade: {}".format(prelim_grade), error_message, None, None, None)
    return render_template('index.html', result=result, message=message, pass_chance=pass_chance, dean_lister_message=dean_lister_message, prelim_grade_result=prelim_grade_result, midterm_result=midterm_result, finals_result=finals_result, error_message=error_message)

if __name__ == '__main__':
    app.run(debug=True)
